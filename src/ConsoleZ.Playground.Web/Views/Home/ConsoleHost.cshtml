@model Tuple<ConsoleZ.VirtualConsole, ConsoleZ.Web.ConsoleData>
<style>
    .console-container {
        white-space: pre;
        font-family: Consolas, monospace;
        font-size: 10pt;
        line-height: 1; /* Allow line-art to touch */
        color: aliceblue;
        min-height: 50px;
        width: 100%;
        padding: 4px;
        background: #333;
    }

    .console-active {
        border: 4px solid green;
    }

    .console-error {
        border: 4px solid red;
    }
</style>
<h3 id="page-title">@Model.Item1.Title</h3>
<div class="row" id="console-host">
    <div class="console-container" id="consoleOut" data-version="-1">@{ WriteLiteral(Model.Item2.HtmlContent);}</div>
    <p class="text-right">
        <a href="#" class="d-none" id="console-next-bottom">Next</a>
    </p>
</div>

<script>
    //function runConsoleCommand(cmd) {
    //    $.post('/Home/ConsoleStart',
    //            {
    //                "consoleText": cmd
    //            })
    //        .done(function(r) {


    //            document.getElementById('console-host').appendChild();
    //            $('#consoleOut').addClass("console-active");
    //            updateConsole(r);
    //            startRefresh(r);
    //        })
    //        .fail(function(ee) {
    //            $('#consoleOut').addClass("console-error");
    //            document.getElementById('consoleOut').innerHTML = ee;
    //        });
    //}

    //function startRefresh(cons, consid) {
    //    setInterval(function() {
    //            $.ajax(cons.updateUrl)
    //                .done(function(aa) {
    //                    updateConsole(aa, consid);
    //                });
    //        },
    //        1000);
    //}

    function updateConsole(cons, targetId) {
        var container = document.getElementById(targetId);
        var version = container.getAttribute("data-version");

        if (version !== cons.version) {

            document.getElementById('page-title').innerHTML = cons.props["title"];
            container.innerHTML = cons.htmlContent;
            container.setAttribute("data-version", cons.version);

            if (cons.doneUrl != null) {
              
                document.getElementById('console-next-bottom').href = cons.doneUrl;
                document.getElementById('console-next-bottom').className = 'btn btn-primary';
            }
        }

    }

    setInterval(function () {
            $.ajax('@Url.Action("ConsoleUpdate", new {id=Model.Item1.Handle})')
                .done(function (aa) {
                    updateConsole(aa, 'consoleOut');
                })
                .fail(function (aa) {
                    document.getElementById('consoleOut').innerHTML = aa;
                });;
        },
        1000);
    
</script>